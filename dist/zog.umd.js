!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ZogLibrary={})}(this,function(e){"use strict";let t=null;const n=[];class s{subs=new Set;depend(){t&&!this.subs.has(t)&&(this.subs.add(t),t.deps.push(this))}notify(){new Set(this.subs).forEach(e=>{e!==t&&(e.scheduler?e.scheduler(e.run.bind(e)):o(e))})}}let r=[],i=!1;const o=e=>{r.includes(e)||(r.push(e),i||(i=!0,Promise.resolve().then(c)))},c=()=>{try{r.sort((e,t)=>(e.id||0)-(t.id||0));for(const e of r)e.active&&e.run()}finally{r=[],i=!1}};let l=0;class f{constructor(e,t=null){this.id=l++,this.fn=e,this.scheduler=t,this.deps=[],this.active=!0}run(){if(!this.active)return this.fn();this.cleanup();try{return n.push(this),t=this,this.fn()}finally{n.pop(),t=n[n.length-1]||null}}cleanup(){for(const e of this.deps)e.subs.delete(this);this.deps=[]}stop(){this.active&&(this.cleanup(),this.active=!1)}}const a=(e,t={})=>{const n=new f(e,t.scheduler);return n.run(),()=>n.stop()},u=Symbol("raw"),d=Symbol("isReactive"),p=new WeakMap,h=e=>e&&"object"==typeof e,y=new Set(["push","pop","shift","unshift","splice","sort","reverse","fill","copyWithin"]),m=new Set(["includes","indexOf","lastIndexOf","find","findIndex","some","every","filter","map","forEach","reduce","reduceRight","flat","flatMap","join","slice","concat"]),v=e=>{if(!h(e)||e[d])return e;const t=p.get(e);if(t)return t;const n=Array.isArray(e),r=new Map,i=new s,o=e=>{let t=r.get(e);return t||(t=new s,r.set(e,t)),t},c=e=>{const t=y.has(e),n=m.has(e);return function(...s){const r=this[u];n&&(i.depend(),o("length").depend());const c=s.map(e=>h(e)&&e[d]?e[u]:e),l=r[e].apply(r,c);return t&&(i.notify(),o("length").notify()),h(l)&&!l[d]?v(l):l}},l=n?{}:null;n&&[...y,...m].forEach(e=>{l[e]=c(e)});const f=new Proxy(e,{get:(e,t,s)=>{if(t===d)return!0;if(t===u)return e;if(n&&l&&t in l)return l[t].bind(s);if(n&&"length"===t)return o("length").depend(),i.depend(),e.length;if(t===Symbol.iterator)return i.depend(),function*(){const t=e.length;for(let n=0;n<t;n++){const t=e[n];yield h(t)?v(t):t}};o(t).depend();const r=Reflect.get(e,t,s);return r&&r._isRef?r:h(r)?v(r):r},set:(e,t,s,r)=>{const c=e[t],l=Number(t),f=n?Number.isInteger(l)&&l>=0&&l<e.length:Object.prototype.hasOwnProperty.call(e,t),a=h(s)&&s[d]?s[u]:s,p=Reflect.set(e,t,a,r);return Object.is(c,a)||(o(t).notify(),(!f||n&&"length"===t)&&(i.notify(),n&&o("length").notify())),p},deleteProperty:(e,t)=>{const n=t in e,s=Reflect.deleteProperty(e,t);return n&&(o(t).notify(),i.notify()),s},ownKeys:e=>(i.depend(),Reflect.ownKeys(e)),has:(e,t)=>(i.depend(),o(t).depend(),Reflect.has(e,t))});return p.set(e,f),f},b=e=>{const t=new s;return{_isRef:!0,get value(){return t.depend(),e},set value(n){Object.is(n,e)||(e=n,t.notify())},toString:()=>String(e)}},g=e=>{let t,n=!0;const r=new s,i=new f(e,()=>{n||(n=!0,r.notify())});return{_isRef:!0,get value(){return n&&(t=i.run(),n=!1),r.depend(),t},_effect:i}};class w{constructor(e){this.data=e,this.effects=[],this.listeners=[]}addEffect(e){this.effects.push(e)}addListener(e,t,n){this.listeners.push({el:e,ev:t,fn:n})}cleanup(){this.effects.forEach(e=>e()),this.listeners.forEach(({el:e,ev:t,fn:n})=>e.removeEventListener(t,n)),this.effects=[],this.listeners=[]}}const A=new Map,E=(e,t)=>{try{let n=A.get(e);if(!n){const s=Object.keys(t);if(n={fn:Function(...s,`"use strict";return(${e})`),keys:s},A.size>200){const e=A.keys().next().value;A.delete(e)}A.set(e,n)}const s=n.keys.map(e=>{const n=t[e];return n?._isRef?n.value:n});return n.fn(...s)}catch(n){return}},x=(e,t,n)=>{if(!e)return;if(3===e.nodeType){const s=e.textContent;return void(s.includes("{{")&&n.addEffect(a(()=>{e.textContent=s.replace(/{{\s*(.*?)\s*}}/g,(e,n)=>E(n,t)??"")})))}if(1!==e.nodeType)return;if(e.hasAttribute("z-if")){const s=[];let r=e,i=e.parentNode;if(!i)return;const o=document.createComment("z-if");for(i.insertBefore(o,e);r;){const e=["z-if","z-else-if","z-else"].find(e=>r.hasAttribute(e));if(!e)break;const t=r.getAttribute(e);r.removeAttribute(e),s.push({template:r.cloneNode(!0),exp:t,type:e,el:null,scope:null});const n=r.nextElementSibling;r.remove(),r=n}return n.addEffect(a(()=>{const e=s.find(e=>"z-else"===e.type||E(e.exp,t));s.forEach(n=>{n===e?n.el&&n.el.parentNode||(n.scope&&n.scope.cleanup(),n.el=n.template.cloneNode(!0),n.scope=new w({...t}),i.insertBefore(n.el,o),x(n.el,n.scope.data,n.scope)):(n.el&&n.el.parentNode&&n.el.remove(),n.scope&&(n.scope.cleanup(),n.scope=null),n.el=null)})})),void n.addEffect(()=>s.forEach(e=>e.scope?.cleanup()))}if(e.hasAttribute("z-else-if")||e.hasAttribute("z-else"))return;if(e.hasAttribute("z-for")){const s=e.getAttribute("z-for"),r=s.match(/^\s*(?:\((\w+)\s*,\s*(\w+)\)|(\w+))\s+(?:in|of)\s+(.*)$/);let i="item",o="index",c=s;if(r)i=r[1]||r[3],o=r[2]||"index",c=r[4];else{const e=s.split(/\s+(?:in|of)\s+/);2===e.length&&(i=e[0].trim(),c=e[1].trim())}const l=e.parentNode;if(!l)return;const f=document.createComment("z-for");l.insertBefore(f,e),e.remove(),e.removeAttribute("z-for");const u=e.getAttribute(":key")||e.getAttribute("z-key");u&&(e.removeAttribute(":key"),e.removeAttribute("z-key"));let d=new Map;const p=()=>{let n=E(c,t);n?._isRef&&(n=n.value),Array.isArray(n)||(n=[]);const s=new Map,r=[];n.forEach((n,c)=>{const l=u?E(u,{...t,[i]:{_isRef:!0,value:n},[o]:{_isRef:!0,value:c}}):c;r.push(l);const f=d.get(l);if(f)f.itemRef.value=n,f.indexRef.value=c,s.set(l,f);else{const r=e.cloneNode(!0),f=b(n),a=b(c),u=new w({...t,[i]:f,[o]:a});x(r,u.data,u),s.set(l,{clone:r,scope:u,itemRef:f,indexRef:a})}});for(const[e,t]of d)s.has(e)||(t.clone.remove(),t.scope.cleanup());let a=f;for(const e of r){const t=s.get(e);t.clone.previousSibling!==a&&l.insertBefore(t.clone,a.nextSibling),a=t.clone}d=s};return n.addEffect(a(p)),void n.addEffect(()=>{for(const e of d.values())e.scope.cleanup();d.clear()})}const s=Array.from(e.attributes);for(const{name:r,value:i}of s)if(r.startsWith("@")||r.startsWith("z-on:")){const s=r.startsWith("@")?r.slice(1):r.slice(5);e.removeAttribute(r);const o=e=>{const n=t[i];"function"==typeof n?n(e):E(i,t)};e.addEventListener(s,o),n.addListener(e,s,o)}else if("z-model"===r){e.removeAttribute(r);const s="checkbox"===e.type||"radio"===e.type,o=s?"checked":"value",c=s||"SELECT"===e.tagName?"change":"input",l=()=>{const n=e[o];if("radio"===e.type&&!e.checked)return;const s=t[i];s?._isRef?s.value=n:void 0!==t[i]&&(t[i]=n)};e.addEventListener(c,l),n.addListener(e,c,l),n.addEffect(a(()=>{const n=E(i,t);"radio"===e.type?e.checked=String(e.value)===String(n):e[o]=n}))}else if(r.startsWith(":")||r.startsWith("z-")){const s=r.startsWith(":")?r.slice(1):r;e.removeAttribute(r);const o="class"===s?e.className:"";n.addEffect(a(()=>{const n=E(i,t);if("z-text"===s)e.textContent=n??"";else if("z-html"===s)e.innerHTML=n??"";else if("z-show"===s)e.style.display=n?"":"none";else if("style"===s&&h(n))Object.keys(n).forEach(t=>e.style[t]=n[t]);else if("class"===s)if(h(n)){const t=Object.keys(n).filter(e=>n[e]).join(" ");e.className=(o+" "+t).trim()}else"string"==typeof n&&(e.className=(o+" "+n).trim());else if("boolean"==typeof n){const t=s.startsWith("z-")?s.slice(2):s;n?e.setAttribute(t,""):e.removeAttribute(t)}else{const t=s.startsWith("z-")?s.slice(2):s;null==n?e.removeAttribute(t):e.setAttribute(t,n)}}))}Array.from(e.childNodes).forEach(e=>x(e,t,n))},z=new Set,R=e=>{let t=null;return{mount(n){const s=document.querySelector(n);if(!s)return;const r=e();return t=new w(r),x(s,r,t),this},unmount(){t&&(t.cleanup(),t=null)}}};e.computed=g,e.createApp=R,e.nextTick=e=>Promise.resolve().then(e),e.reactive=v,e.ref=b,e.use=(e,t={})=>{if(z.has(e))return;if("function"!=typeof e.install)return;z.add(e);const n={reactive:v,ref:b,computed:g,watchEffect:a,createApp:R,utils:{isObj:h,evalExp:E,Dep:s,ReactiveEffect:f}};try{e.install(n,t)}catch(r){}},e.watchEffect=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});
