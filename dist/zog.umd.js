!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ZogLibrary={})}(this,function(e){"use strict";let t=null;const s=[];class n{subs=new Set;depend(){t&&!this.subs.has(t)&&(this.subs.add(t),t.deps.push(this))}notify(){this.subs.forEach(e=>{e.scheduler?e.scheduler(e.run.bind(e)):e.run()})}}class r{constructor(e,t=null){this.fn=e,this.scheduler=t,this.deps=[],this.active=!0}run(){if(this.active)try{return s.push(this),t=this,this.fn()}finally{s.pop(),t=s[s.length-1]||null}}stop(){this.active&&(this.deps.forEach(e=>e.subs.delete(this)),this.deps=[],this.active=!1)}}const o=(e,t={})=>{const s=new r(e,t.scheduler);return s.run(),()=>s.stop()},i=Symbol(),c=Symbol(),a=new WeakMap,f=e=>e&&"object"==typeof e,l=e=>{if(!f(e)||e[c])return e;const t=a.get(e);if(t)return t;const s=new Map,r=e=>{let t=s.get(e);return t||(t=new n,s.set(e,t)),t},o=new Proxy(e,{get:(e,t)=>{if(t===c)return!0;if(t===i)return e;r(t).depend();const s=Reflect.get(e,t);return s&&s._isRef?s:f(s)?l(s):s},set:(e,t,s)=>{const n=e[t],o=Reflect.set(e,t,s);return Object.is(n,s)||r(t).notify(),o},deleteProperty:(e,t)=>{const s=t in e,n=Reflect.deleteProperty(e,t);return s&&r(t).notify(),n}});return a.set(e,o),o},u=e=>{const t=new n;return{_isRef:!0,get value(){return t.depend(),e},set value(s){Object.is(s,e)||(e=s,t.notify())},toString:()=>String(e)}};class d{constructor(e){this.data=e,this.effects=[],this.listeners=[]}addEffect(e){this.effects.push(e)}addListener(e,t,s){this.listeners.push({el:e,ev:t,fn:s})}cleanup(){this.effects.forEach(e=>e()),this.listeners.forEach(({el:e,ev:t,fn:s})=>e.removeEventListener(t,s)),this.effects=[],this.listeners=[]}}const h=(e,t)=>{try{const s=Object.keys(t),n=s.map(e=>t[e]?._isRef?t[e].value:t[e]);return Function(...s,`"use strict";return(${e})`)(...n)}catch(s){return}},p=(e,t,s)=>{if(e){if(3===e.nodeType){const n=e.textContent;return void(n.includes("{{")&&s.addEffect(o(()=>{e.textContent=n.replace(/{{\s*(.*?)\s*}}/g,(e,s)=>h(s,t)??"")})))}if(1===e.nodeType){if(e.hasAttribute("z-if")){const n=[];let r=e,i=e.parentNode;if(!i)return;const c=document.createComment("z-if");for(i.insertBefore(c,e);r;){const e=["z-if","z-else-if","z-else"].find(e=>r.hasAttribute(e));if(!e)break;const t=r.getAttribute(e);r.removeAttribute(e),n.push({el:r,exp:t,type:e,scope:null});const s=r.nextElementSibling;r.remove(),r=s}return s.addEffect(o(()=>{const e=n.find(e=>"z-else"===e.type||h(e.exp,t));n.forEach(s=>{s===e?s.el.parentNode||(i.insertBefore(s.el,c),s.scope||(s.scope=new d({...t}),p(s.el,s.scope.data,s.scope))):(s.el.parentNode&&s.el.remove(),s.scope&&(s.scope.cleanup(),s.scope=null))})})),void s.addEffect(()=>n.forEach(e=>e.scope?.cleanup()))}if(!e.hasAttribute("z-else-if")&&!e.hasAttribute("z-else")){if(e.hasAttribute("z-for")){const n=e.getAttribute("z-for"),r=n.match(/^\s*(?:\((\w+)\s*,\s*(\w+)\)|(?:(\w+)))\s+(?:in|of)\s+(.*)$/);let i="item",c="index",a=n;if(r)i=r[1]||r[3]||"item",c=r[2]||"index",a=r[4];else{const e=n.split(/\s+in\s+|\s+of\s+/);2===e.length&&(i=e[0].trim(),a=e[1].trim())}const f=e.parentNode;if(!f)return;const l=document.createComment("z-for");f.insertBefore(l,e),e.remove(),e.removeAttribute("z-for");let m=[];return s.addEffect(o(()=>{m.forEach(({clone:e,scope:t})=>{e.remove(),t.cleanup()}),m=[];const s=h(a,t)||[];Array.isArray(s)&&s.forEach((s,n)=>{const r=e.cloneNode(!0);f.insertBefore(r,l);const o=new d({...t,[i]:u(s),[c]:u(n)});p(r,o.data,o),m.push({clone:r,scope:o})})})),void s.addEffect(()=>m.forEach(({scope:e})=>e.cleanup()))}Array.from(e.attributes).forEach(({name:n,value:r})=>{if(n.startsWith("@")||n.startsWith("z-on:")){const o=n.startsWith("@")?n.slice(1):n.slice(5);e.removeAttribute(n);const i=e=>{const s=t[r];"function"==typeof s?s(e):h(r,t)};e.addEventListener(o,i),s.addListener(e,o,i)}else if("z-model"===n){e.removeAttribute(n);const i="checkbox"===e.type||"radio"===e.type,c=i?"checked":"value",a=i||"SELECT"===e.tagName?"change":"input",f=()=>{const s=e[c];if("radio"===e.type&&!e.checked)return;const n=t[r];n?._isRef?n.value=s:void 0!==t[r]&&(t[r]=s)};e.addEventListener(a,f),s.addListener(e,a,f),s.addEffect(o(()=>{const s=h(r,t);"radio"===e.type?e.checked=String(e.value)===String(s):e[c]=s}))}else if(n.startsWith(":")||n.startsWith("z-")){const i=n.startsWith(":")?n.slice(1):n;e.removeAttribute(n);const c="class"===i?e.className:"";s.addEffect(o(()=>{const s=h(r,t);if("z-text"===i)e.textContent=s??"";else if("z-html"===i)e.innerHTML=s??"";else if("z-show"===i)e.style.display=s?"":"none";else if("style"===i&&f(s))Object.assign(e.style,s);else if("class"===i&&f(s)){const t=Object.keys(s).filter(e=>s[e]).join(" ");e.className=(c+" "+t).trim()}else{const t=i.startsWith("z-")?i.slice(2):i;e.setAttribute(t,s??"")}}))}}),Array.from(e.childNodes).forEach(e=>p(e,t,s))}}}},m="undefined"!=typeof window,v=()=>m?Object.fromEntries(new URLSearchParams(location.search)):{},y={h:u(m?location.hash:""),p:u(m?location.pathname:""),q:u(m?v():{})},b=()=>{m&&(y.h.value=location.hash,y.p.value=location.pathname,y.q.value=v())};m&&(addEventListener("hashchange",b),addEventListener("popstate",b));const g={get hash(){return y.h.value},get path(){return y.p.value},get query(){return y.q.value}};e.computed=e=>{let t,s=!0;const o=new n,i=new r(e,()=>{s||(s=!0,o.notify())});return{_isRef:!0,get value(){return s&&(t=i.run(),s=!1),o.depend(),t},_effect:i}},e.createApp=e=>{let t=null;return{mount(s){const n=document.querySelector(s);if(!n)return;const r=e();return t=new d(r),p(n,r,t),this},unmount(){t&&(t.cleanup(),t=null)}}},e.nextTick=e=>Promise.resolve().then(e),e.reactive=l,e.ref=u,e.route=g,e.toRef=(e,t)=>{const s=e[t];return s?._isRef?s:{_isRef:!0,get value(){return e[t]},set value(s){e[t]=s}}},e.unref=e=>e?._isRef?e.value:e,e.watchEffect=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});
