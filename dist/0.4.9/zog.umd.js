!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Zog={})}(this,function(e){"use strict";let t=null;const n=[];let s=null;class r{subs=new Set;depend(){t&&!this.subs.has(t)&&(this.subs.add(t),t.deps.push(this))}notify(){new Set(this.subs).forEach(e=>{e!==t&&(e.scheduler?e.scheduler(e.run.bind(e)):l(e))})}}let i=[],o=!1;const l=e=>{i.includes(e)||(i.push(e),o||(o=!0,Promise.resolve().then(c)))},c=()=>{const e=i.slice().sort((e,t)=>e.id-t.id);i.length=0,o=!1;for(const n of e)if(n.active)try{n.run()}catch(t){j("onError",t,"effect",n)}};let f=0;class a{constructor(e,t=null){this.id=f++,this.fn=e,this.scheduler=t,this.deps=[],this.active=!0}run(){if(!this.active)return this.fn();this.cleanup();try{return n.push(this),t=this,this.fn()}finally{n.pop(),t=n[n.length-1]||null}}stop(){this.active&&(this.cleanup(),this.active=!1)}cleanup(){for(const e of this.deps)e.subs.delete(this);this.deps.length=0}}const u=(e,t={})=>{const n=new a(e,t.scheduler);n.run();const r=()=>n.stop();return s?.addEffect(r),r},d=Symbol("raw"),h=Symbol("isReactive"),p=new WeakMap,y=e=>e&&"object"==typeof e,m=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),v=new Set(["push","pop","shift","unshift","splice","sort","reverse","fill","copyWithin"]),b=new Set(["includes","indexOf","lastIndexOf","find","findIndex","findLast","findLastIndex","every","some","forEach","map","filter","reduce","reduceRight","flat","flatMap","values","entries","keys",Symbol.iterator]),g=e=>{if(!y(e)||e[h])return e;if(p.has(e))return p.get(e);const t=Array.isArray(e),n=new Map,s=new r,i=e=>n.get(e)||(n.set(e,new r),n.get(e)),o=e=>{const t=v.has(e),n=b.has(e);return function(...r){const o=this[d];let l;if(!t&&n&&s.depend(),"includes"===e||"indexOf"===e||"lastIndexOf"===e){i("length").depend();for(let e=0;e<o.length;e++)i(String(e)).depend();l=Array.prototype[e].call(o,r[0]?.[d]??r[0],...r.slice(1))}else l=Array.prototype[e].apply(t?o:this,r);if(t&&(s.notify(),i("length").notify(),"sort"===e||"reverse"===e||"shift"===e||"unshift"===e))for(let e=0;e<o.length;e++)i(String(e)).notify();return y(l)&&!l[h]?g(l):l}},l=t?Object.fromEntries([...v,...b].map(e=>[e,o(e)])):null,c=new Proxy(e,{get(e,n,s){if(n===d)return e;if(n===h)return!0;if(t&&l?.[n])return l[n];i(n).depend();const r=Reflect.get(e,n,s);return y(r)?r[h]?r:g(r):r},set(e,n,r,o){const l=e[n],c=m(e,n),f=Reflect.set(e,n,r,o);return c&&Object.is(l,r)||(i(n).notify(),c&&(!t||"length"!==n&&String(+n)!==n)||s.notify()),f},deleteProperty(e,t){const n=m(e,t),r=Reflect.deleteProperty(e,t);return n&&(i(t).notify(),s.notify()),r},ownKeys:e=>(s.depend(),Reflect.ownKeys(e)),has:(e,t)=>(i(t).depend(),Reflect.has(e,t))});return p.set(e,c),c},w=e=>{if(y(e))throw new Error("ref() cannot be used with objects or arrays. Use reactive() instead.");let t=e;const n=new r;return{_isRef:!0,get value(){return n.depend(),t},set value(e){if(y(e))throw new Error("ref() value cannot be set to an object or array.");Object.is(e,t)||(t=e,n.notify())},toString:()=>String(t)}},x=e=>{let t,n=!0;const s=new r,i=new a(e,()=>{n||(n=!0,s.notify())});return{_isRef:!0,get value(){return n&&(t=i.run(),n=!1),s.depend(),t},_effect:i}};class E{constructor(e){this.data=e,this.effects=[],this.listeners=[],this.children=[]}addEffect(e){this.effects.push(e)}addListener(e,t,n){this.listeners.push({el:e,ev:t,fn:n})}addChild(e){this.children.push(e)}removeChild(e){this.children=this.children.filter(t=>t!==e)}cleanup(){this.children.forEach(e=>e.cleanup()),this.children.length=0,this.effects.forEach(e=>e?.()),this.effects.length=0,this.listeners.forEach(({el:e,ev:t,fn:n})=>e.removeEventListener(t,n)),this.listeners.length=0}}const A=new Map,z=(e,t)=>{try{const n=Object.keys(t),s=e+"|"+n.join(",");let r=A.get(s);r||(r=Function(...n,`"use strict";try{return(${e})}catch(e){return undefined}`),A.size>500&&A.delete(A.keys().next().value),A.set(s,r));return r(...n.map(e=>{const n=t[e];return n?._isRef?n.value:n}))}catch{return}},S={},k=(e,t)=>(S[e]=S[e]||[]).push(t),j=(e,...t)=>{const n=S[e];if(n)for(const r of n)try{if(!1===r(...t))return!1}catch(s){}},C=(e,t,n)=>{if(!1!==j("beforeCompile",e,t,n)){if(3===e.nodeType){const s=e.nodeValue,r=/\{\{([^}]+)\}\}/g;if(!r.test(s))return;const i=[];let o,l=0;for(r.lastIndex=0;o=r.exec(s);)o.index>l&&i.push(s.slice(l,o.index)),i.push({exp:o[1].trim()}),l=r.lastIndex;return l<s.length&&i.push(s.slice(l)),void n.addEffect(u(()=>{e.nodeValue=i.map(e=>"string"==typeof e?e:z(e.exp,t)??"").join("")}))}if(1===e.nodeType){if(e.hasAttribute("z-if")){const s=[],r=e.parentNode;if(!r)return;const i=document.createComment("z-if");r.insertBefore(i,e);let o=e;for(;o;){const e=["z-if","z-else-if","z-else"].find(e=>o.hasAttribute(e));if(!e)break;const t=o.getAttribute(e);o.removeAttribute(e),s.push({template:o.cloneNode(!0),exp:t,type:e,el:null,scope:null});const n=o.nextElementSibling;r.removeChild(o),o=n}return n.addEffect(u(()=>{let e=null;for(const n of s)if("z-else"===n.type||z(n.exp,t)){e=n;break}s.forEach(s=>{s===e?s.el||(s.el=s.template.cloneNode(!0),s.scope=new E({...t}),n.addChild(s.scope),r.insertBefore(s.el,i.nextSibling),C(s.el,s.scope.data,s.scope)):s.scope&&(s.el?.remove(),s.scope.cleanup(),n.removeChild(s.scope),s.scope=null,s.el=null)})})),void j("afterCompile",e,t,n)}if(!e.hasAttribute("z-else-if")&&!e.hasAttribute("z-else")){if(e.hasAttribute("z-for")){const s=e.getAttribute("z-for"),r=s.match(/^\s*(?:\((\w+)\s*,\s*(\w+)\)|(\w+))\s+(?:in|of)\s+(.*)$/),i=r?.[1]||r?.[3]||"item",o=r?.[2]||"index",l=r?.[4]||s.split(/\s+(?:in|of)\s+/)[1]?.trim()||s,c=e.parentNode;if(!c)return;const f=document.createComment("z-for");c.insertBefore(f,e),e.remove(),e.removeAttribute("z-for");const a=e.getAttribute(":key")||e.getAttribute("z-key");a&&(e.removeAttribute(":key"),e.removeAttribute("z-key"));let d=new Map;return n.addEffect(u(()=>{let s=z(l,t);s?._isRef&&(s=s.value),Array.isArray(s)||(s=[]);const r=new Map,u=[];s.forEach((s,l)=>{const c="_"+(a?z(a,{...t,[i]:s,[o]:l}):l);u.push(c);const f=d.get(c),p=y(s)&&!s[h]?g(s):s,m=p&&p[h];if(f){if(!m||f.itemValue===p)return m||(f.itemRef.value=p),f.scope.data[o]=l,void r.set(c,f);f.clone.remove(),f.scope.cleanup(),n.removeChild(f.scope)}const v=e.cloneNode(!0);let b,x;m?(b=p,x=null):(x=w(p),b=x);const A=l,S=new E({...t,[i]:b,[o]:A});n.addChild(S),C(v,S.data,S),r.set(c,{clone:v,scope:S,itemValue:b,itemRef:x})});for(const[e,t]of d)r.has(e)||(t.clone.remove(),t.scope.cleanup(),n.removeChild(t.scope));let p=f;for(const e of u){const t=r.get(e);t.clone.previousSibling!==p&&c.insertBefore(t.clone,p.nextSibling),p=t.clone}d=r})),void j("afterCompile",e,t,n)}for(const{name:s,value:r}of[...e.attributes])if(s.startsWith("@")||s.startsWith("z-on:")){const i="@"===s[0]?s.slice(1):s.slice(5);e.removeAttribute(s);const o=e=>{if("function"==typeof t[r])t[r](e);else try{const n=Object.keys(t),s=n.map(e=>t[e]);Function(...n,"e",`"use strict";${r}`)(...s,e)}catch(n){j("onError",n,"event",{name:s,value:r})}};e.addEventListener(i,o),n.addListener(e,i,o)}else if("z-model"===s){e.removeAttribute(s);const i="checkbox"===e.type||"radio"===e.type,o=i?"checked":"value",l=i||"SELECT"===e.tagName?"change":"input",c=()=>{if("radio"===e.type&&!e.checked)return;const n="radio"===e.type?e.value:e[o];t[r]?._isRef?t[r].value=n:z(r+"=_v",{...t,_v:n})};e.addEventListener(l,c),n.addListener(e,l,c),n.addEffect(u(()=>{const n=z(r,t);"radio"===e.type?e.checked=String(e.value)===String(n):e[o]=n}))}else if("z-text"===s||"z-html"===s||"z-show"===s||s.startsWith(":")||s.startsWith("z-")){const i=":"===s[0]?s.slice(1):s;e.removeAttribute(s);const o="class"===i&&e.getAttribute("class")||"";n.addEffect(u(()=>{const n=z(r,t);if("z-text"===i)e.textContent=n??"";else if("z-html"===i)e.innerHTML=n??"";else if("z-show"===i)e.style.display=n?"":"none";else if("style"===i&&y(n))Object.assign(e.style,n);else if("class"===i)e.setAttribute("class",(y(n)?o+" "+Object.keys(n).filter(e=>n[e]).join(" "):"string"==typeof n?o+" "+n:o).trim());else{const t=i.startsWith("z-")?i.slice(2):i;"boolean"==typeof n?n?e.setAttribute(t,""):e.removeAttribute(t):null==n?e.removeAttribute(t):e.setAttribute(t,n)}}))}[...e.childNodes].forEach(e=>C(e,t,n)),j("afterCompile",e,t,n)}}}};e.computed=x,e.createApp=e=>{let t=null;const n={plugins:new Set};return{use(e,t={}){return n.plugins.has(e)||"function"!=typeof e.install||(e.install({app:this,reactive:g,ref:w,computed:x,watchEffect:u,onHook:k,compile:C,Scope:E,evalExp:z},t),n.plugins.add(e)),this},mount(n){const r="string"==typeof n?document.querySelector(n):n;if(r){t=new E({}),s=t,t.data=e?.()||{},s=null;try{C(r,t.data,t)}catch(i){j("onError",i,"compile",{el:r})}return this}},unmount(){t?.cleanup(),t=null}}},e.nextTick=e=>Promise.resolve().then(e),e.onHook=k,e.reactive=g,e.ref=w,e.watchEffect=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});
