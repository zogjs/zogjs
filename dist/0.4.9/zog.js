let e=null;const t=[];let s=null;class n{subs=/* @__PURE__ */new Set;depend(){e&&!this.subs.has(e)&&(this.subs.add(e),e.deps.push(this))}notify(){new Set(this.subs).forEach(t=>{t!==e&&(t.scheduler?t.scheduler(t.run.bind(t)):o(t))})}}let r=[],i=!1;const o=e=>{r.includes(e)||(r.push(e),i||(i=!0,Promise.resolve().then(l)))},l=()=>{const e=r.slice().sort((e,t)=>e.id-t.id);r.length=0,i=!1;for(const s of e)if(s.active)try{s.run()}catch(t){k("onError",t,"effect",s)}};let c=0;class a{constructor(e,t=null){this.id=c++,this.fn=e,this.scheduler=t,this.deps=[],this.active=!0}run(){if(!this.active)return this.fn();this.cleanup();try{return t.push(this),e=this,this.fn()}finally{t.pop(),e=t[t.length-1]||null}}stop(){this.active&&(this.cleanup(),this.active=!1)}cleanup(){for(const e of this.deps)e.subs.delete(this);this.deps.length=0}}const f=(e,t={})=>{const n=new a(e,t.scheduler);n.run();const r=()=>n.stop();return s?.addEffect(r),r},u=/* @__PURE__ */Symbol("raw"),d=/* @__PURE__ */Symbol("isReactive"),h=/* @__PURE__ */new WeakMap,p=e=>e&&"object"==typeof e,y=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m=/* @__PURE__ */new Set(["push","pop","shift","unshift","splice","sort","reverse","fill","copyWithin"]),v=/* @__PURE__ */new Set(["includes","indexOf","lastIndexOf","find","findIndex","findLast","findLastIndex","every","some","forEach","map","filter","reduce","reduceRight","flat","flatMap","values","entries","keys",Symbol.iterator]),b=e=>{if(!p(e)||e[d])return e;if(h.has(e))return h.get(e);const t=Array.isArray(e),s=/* @__PURE__ */new Map,r=new n,i=e=>s.get(e)||(s.set(e,new n),s.get(e)),o=e=>{const t=m.has(e),s=v.has(e);return function(...n){const o=this[u];let l;if(!t&&s&&r.depend(),"includes"===e||"indexOf"===e||"lastIndexOf"===e){i("length").depend();for(let e=0;e<o.length;e++)i(String(e)).depend();l=Array.prototype[e].call(o,n[0]?.[u]??n[0],...n.slice(1))}else l=Array.prototype[e].apply(t?o:this,n);if(t&&(r.notify(),i("length").notify(),"sort"===e||"reverse"===e||"shift"===e||"unshift"===e))for(let e=0;e<o.length;e++)i(String(e)).notify();return p(l)&&!l[d]?b(l):l}},l=t?Object.fromEntries([...m,...v].map(e=>[e,o(e)])):null,c=new Proxy(e,{get(e,s,n){if(s===u)return e;if(s===d)return!0;if(t&&l?.[s])return l[s];i(s).depend();const r=Reflect.get(e,s,n);return p(r)?r[d]?r:b(r):r},set(e,s,n,o){const l=e[s],c=y(e,s),a=Reflect.set(e,s,n,o);return c&&Object.is(l,n)||(i(s).notify(),c&&(!t||"length"!==s&&String(+s)!==s)||r.notify()),a},deleteProperty(e,t){const s=y(e,t),n=Reflect.deleteProperty(e,t);return s&&(i(t).notify(),r.notify()),n},ownKeys:e=>(r.depend(),Reflect.ownKeys(e)),has:(e,t)=>(i(t).depend(),Reflect.has(e,t))});return h.set(e,c),c},g=e=>{if(p(e))throw new Error("ref() cannot be used with objects or arrays. Use reactive() instead.");let t=e;const s=new n;return{_isRef:!0,get value(){return s.depend(),t},set value(e){if(p(e))throw new Error("ref() value cannot be set to an object or array.");Object.is(e,t)||(t=e,s.notify())},toString:()=>String(t)}},w=e=>{let t,s=!0;const r=new n,i=new a(e,()=>{s||(s=!0,r.notify())});return{_isRef:!0,get value(){return s&&(t=i.run(),s=!1),r.depend(),t},_effect:i}};class E{constructor(e){this.data=e,this.effects=[],this.listeners=[],this.children=[]}addEffect(e){this.effects.push(e)}addListener(e,t,s){this.listeners.push({el:e,ev:t,fn:s})}addChild(e){this.children.push(e)}removeChild(e){this.children=this.children.filter(t=>t!==e)}cleanup(){this.children.forEach(e=>e.cleanup()),this.children.length=0,this.effects.forEach(e=>e?.()),this.effects.length=0,this.listeners.forEach(({el:e,ev:t,fn:s})=>e.removeEventListener(t,s)),this.listeners.length=0}}const A=/* @__PURE__ */new Map,x=(e,t)=>{try{const s=Object.keys(t),n=e+"|"+s.join(",");let r=A.get(n);r||(r=Function(...s,`"use strict";try{return(${e})}catch(e){return undefined}`),A.size>500&&A.delete(A.keys().next().value),A.set(n,r));return r(...s.map(e=>{const s=t[e];return s?._isRef?s.value:s}))}catch{return}},z={},S=(e,t)=>(z[e]=z[e]||[]).push(t),k=(e,...t)=>{const s=z[e];if(s)for(const r of s)try{if(!1===r(...t))return!1}catch(n){}},C=(e,t,s)=>{if(!1!==k("beforeCompile",e,t,s)){if(3===e.nodeType){const n=e.nodeValue,r=/\{\{([^}]+)\}\}/g;if(!r.test(n))return;const i=[];let o,l=0;for(r.lastIndex=0;o=r.exec(n);)o.index>l&&i.push(n.slice(l,o.index)),i.push({exp:o[1].trim()}),l=r.lastIndex;return l<n.length&&i.push(n.slice(l)),void s.addEffect(f(()=>{e.nodeValue=i.map(e=>"string"==typeof e?e:x(e.exp,t)??"").join("")}))}if(1===e.nodeType){if(e.hasAttribute("z-if")){const n=[],r=e.parentNode;if(!r)return;const i=document.createComment("z-if");r.insertBefore(i,e);let o=e;for(;o;){const e=["z-if","z-else-if","z-else"].find(e=>o.hasAttribute(e));if(!e)break;const t=o.getAttribute(e);o.removeAttribute(e),n.push({template:o.cloneNode(!0),exp:t,type:e,el:null,scope:null});const s=o.nextElementSibling;r.removeChild(o),o=s}return s.addEffect(f(()=>{let e=null;for(const s of n)if("z-else"===s.type||x(s.exp,t)){e=s;break}n.forEach(n=>{n===e?n.el||(n.el=n.template.cloneNode(!0),n.scope=new E({...t}),s.addChild(n.scope),r.insertBefore(n.el,i.nextSibling),C(n.el,n.scope.data,n.scope)):n.scope&&(n.el?.remove(),n.scope.cleanup(),s.removeChild(n.scope),n.scope=null,n.el=null)})})),void k("afterCompile",e,t,s)}if(!e.hasAttribute("z-else-if")&&!e.hasAttribute("z-else")){if(e.hasAttribute("z-for")){const n=e.getAttribute("z-for"),r=n.match(/^\s*(?:\((\w+)\s*,\s*(\w+)\)|(\w+))\s+(?:in|of)\s+(.*)$/),i=r?.[1]||r?.[3]||"item",o=r?.[2]||"index",l=r?.[4]||n.split(/\s+(?:in|of)\s+/)[1]?.trim()||n,c=e.parentNode;if(!c)return;const a=document.createComment("z-for");c.insertBefore(a,e),e.remove(),e.removeAttribute("z-for");const u=e.getAttribute(":key")||e.getAttribute("z-key");u&&(e.removeAttribute(":key"),e.removeAttribute("z-key"));let h=/* @__PURE__ */new Map;return s.addEffect(f(()=>{let n=x(l,t);n?._isRef&&(n=n.value),Array.isArray(n)||(n=[]);const r=/* @__PURE__ */new Map,f=[];n.forEach((n,l)=>{const c="_"+(u?x(u,{...t,[i]:n,[o]:l}):l);f.push(c);const a=h.get(c),y=p(n)&&!n[d]?b(n):n,m=y&&y[d];if(a){if(!m||a.itemValue===y)return m||(a.itemRef.value=y),a.scope.data[o]=l,void r.set(c,a);a.clone.remove(),a.scope.cleanup(),s.removeChild(a.scope)}const v=e.cloneNode(!0);let w,A;m?(w=y,A=null):(A=g(y),w=A);const z=l,S=new E({...t,[i]:w,[o]:z});s.addChild(S),C(v,S.data,S),r.set(c,{clone:v,scope:S,itemValue:w,itemRef:A})});for(const[e,t]of h)r.has(e)||(t.clone.remove(),t.scope.cleanup(),s.removeChild(t.scope));let y=a;for(const e of f){const t=r.get(e);t.clone.previousSibling!==y&&c.insertBefore(t.clone,y.nextSibling),y=t.clone}h=r})),void k("afterCompile",e,t,s)}for(const{name:n,value:r}of[...e.attributes])if(n.startsWith("@")||n.startsWith("z-on:")){const i="@"===n[0]?n.slice(1):n.slice(5);e.removeAttribute(n);const o=e=>{if("function"==typeof t[r])t[r](e);else try{const s=Object.keys(t),n=s.map(e=>t[e]);Function(...s,"e",`"use strict";${r}`)(...n,e)}catch(s){k("onError",s,"event",{name:n,value:r})}};e.addEventListener(i,o),s.addListener(e,i,o)}else if("z-model"===n){e.removeAttribute(n);const i="checkbox"===e.type||"radio"===e.type,o=i?"checked":"value",l=i||"SELECT"===e.tagName?"change":"input",c=()=>{if("radio"===e.type&&!e.checked)return;const s="radio"===e.type?e.value:e[o];t[r]?._isRef?t[r].value=s:x(r+"=_v",{...t,_v:s})};e.addEventListener(l,c),s.addListener(e,l,c),s.addEffect(f(()=>{const s=x(r,t);"radio"===e.type?e.checked=String(e.value)===String(s):e[o]=s}))}else if("z-text"===n||"z-html"===n||"z-show"===n||n.startsWith(":")||n.startsWith("z-")){const i=":"===n[0]?n.slice(1):n;e.removeAttribute(n);const o="class"===i&&e.getAttribute("class")||"";s.addEffect(f(()=>{const s=x(r,t);if("z-text"===i)e.textContent=s??"";else if("z-html"===i)e.innerHTML=s??"";else if("z-show"===i)e.style.display=s?"":"none";else if("style"===i&&p(s))Object.assign(e.style,s);else if("class"===i)e.setAttribute("class",(p(s)?o+" "+Object.keys(s).filter(e=>s[e]).join(" "):"string"==typeof s?o+" "+s:o).trim());else{const t=i.startsWith("z-")?i.slice(2):i;"boolean"==typeof s?s?e.setAttribute(t,""):e.removeAttribute(t):null==s?e.removeAttribute(t):e.setAttribute(t,s)}}))}[...e.childNodes].forEach(e=>C(e,t,s)),k("afterCompile",e,t,s)}}}},j=e=>Promise.resolve().then(e),R=e=>{let t=null;const n={plugins:/* @__PURE__ */new Set};return{use(e,t={}){return n.plugins.has(e)||"function"!=typeof e.install||(e.install({app:this,reactive:b,ref:g,computed:w,watchEffect:f,onHook:S,compile:C,Scope:E,evalExp:x},t),n.plugins.add(e)),this},mount(n){const r="string"==typeof n?document.querySelector(n):n;if(r){t=new E({}),s=t,t.data=e?.()||{},s=null;try{C(r,t.data,t)}catch(i){k("onError",i,"compile",{el:r})}return this}},unmount(){t?.cleanup(),t=null}}};export{w as computed,R as createApp,j as nextTick,S as onHook,b as reactive,g as ref,f as watchEffect};
